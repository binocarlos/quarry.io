#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander');
var version = require('../package.json').version;

var fs = require('fs');

var eyes = require('eyes');
var dye = require('dye');

var io = require('../');

var log = require('logule').init(module, 'quarry.io bootloader');

log.info("quarry.io version " + dye.red(version));

program
  .version(version)

/*

  boot up a stack in minimal dev trim that takes the least amount of time to start

  there is no HQ server just a manual static network that runs a single stack 

  it uses IPC sockets and is fully compatable but the reception and switchboard setups
  are not mesh they are standalone

*/
program
  .command('test [path]')
  .description('test a quarry stack')
  .action(function(path){

    process.env.NODE_ENV = 'development';
    
    if(!path){
      path = process.cwd();
    }
    else if(path.indexOf('/')!=0){
      path = process.cwd() + '/' + path;
    }

    path = path.replace(/\/$/, '');

    /*
    
      create a development network
      
    */

    log.info('Booting stack in test mode');

    var network = io.network()
      .teststack(path, function(error){
        if(error){
          log.error(error);
        }
        else{
          log.info('stack booted: testing stack -> ' + path);
        }
      })
    
  })

program
  .command('*')
  .action(function(command){
    console.log('command: "%s" not found', command);
  })

program.parse(process.argv);